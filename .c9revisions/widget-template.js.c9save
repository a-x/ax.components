{"ts":1359158878396,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\"use strict\";\r\n\r\nrequire(\"jquery\");\r\n\r\nvar $ = jQuery,\r\n\tutil = require(\"./util\");\r\n\r\n// Called on function.extend\r\nexports.Widget = util.extender({\r\n    // TODO: Widget.data function with redraw when data changed\r\n    // TODO: Proxy all function\r\n    // $(initElement)\r\n    initElement: \"<div>Widget</div>\"\r\n    // initialize\r\n    , initialize: function() { }\r\n    // signals description {\"click .btn\" : clicked}\r\n    //, TODO: signals: {} // if need\r\n    // events description {\"click .btn\" : clicked}\r\n    , events: {}\r\n    // default object\r\n    , defaults:{}\r\n    // render element \r\n    , render: function() {\r\n        return this;\r\n    }\r\n    // TODO: var listregexp = listregexp || [];\r\n    , dataChanged: function(e, data) {\r\n        //console.log(\"dataChanged\", data, this);\r\n        for (var key in data) {\r\n            data.hasOwnProperty(key) && this.triggerHandler(\"data:\" + key, [data[key]]); //FIXME:  this.data(key)\r\n        }\r\n        this.triggerHandler(\"data\", [data]);\r\n        //TODO: (_render === false) flag\r\n        \r\n        return false;\r\n    }\r\n    // return proxy function\r\n    , proxy: function(func) {\r\n        typeof(func) === \"string\" && ( func = this[func] );\r\n        return $.proxy(func, this);\r\n    }\r\n    // apply element with id to this.id\r\n    , applyNamesById: function() {\r\n        var self = this;\r\n        this.find('[id]').each(function(idx, element) {\r\n            var $el = $(element);\r\n            var id = $el.attr(\"id\");\r\n            self[id] = self[id] || $el;\r\n        })\r\n    }\r\n    // proxy to this all own functions\r\n    , applyProxy: function() {\r\n        for (var key in this) {\r\n            var func = this[key];\r\n            // proxy only own functions\r\n            if ( !( this.hasOwnProperty(key) && typeof(func) === \"function\" ) )\r\n                continue;\r\n\r\n            this[key] = $.proxy(func, this);\r\n        }\r\n    }\r\n    // process events map\r\n    , applyEvents: function() {\r\n        var events = this.events || {};\r\n        for (var key in events) {\r\n            if (!events.hasOwnProperty(key))\r\n                continue;\r\n            var func = events[key];\r\n            typeof(func) !== \"function\" && (func = this[func]);\r\n            typeof(func) !== \"function\" && console.log(\"error function: \", func);\r\n            var match = key.match( /^(\\S+)\\s*(.*)$/);\r\n            var event = match[1], selector = match[2];\r\n            selector ? this.on(event, selector, this.proxy(func)) : this.on(event, this.proxy(func))\r\n        }\r\n    }\r\n}, function(data, el) {\r\n    \r\n    // FIXME: fix when called as function\r\n    el = $(el || ((typeof(this.initElement) === \"function\") ? this.initElement() : this.initElement));\r\n\r\n    var ctor = function() {};\r\n    ctor.prototype = el;\r\n    var widget = new ctor();\r\n\r\n    el.data(\"widget\", widget);\r\n    $.extend(widget, this);\r\n\r\n    // extend data \r\n    data = $.extend({}, this.defaults, data || {});\r\n    widget.data(data);\r\n\r\n    // Some extra init\r\n    widget.applyNamesById();\r\n    // FIXME: widget.applyProxy();\r\n    widget.applyEvents();\r\n    widget.on(\"dataChanged\", widget.proxy(widget.dataChanged))\r\n    widget.on(\"data\", widget.proxy(widget.render));\r\n    \r\n    widget.initialize();\r\n    \r\n    widget.triggerHandler(\"dataChanged\", [widget.data()]);\r\n    return widget;\r\n});\r\n\r\n//----------------------------------------------------------------\r\n// FIXME: or fix jquery - $(elem)data(obj) trigger changeData event\r\n$.fn.data = (function() {\r\n    var $data = $.fn.data;\r\n    return function (key, value) {\r\n        var res = $data.apply(this, arguments);\r\n\r\n        // trigger only if set data\r\n        if ( !( !arguments.length || ( arguments.length === 1 && typeof(key) === \"string\" ) ) ) {\r\n            var data = {};\r\n            typeof(key) === \"string\" ? data[key] = value : data = key;\r\n            this.triggerHandler(\"dataChanged\", data);\r\n        }\r\n        return res;\r\n    };\r\n})();\r\n//----------------------------------------------------------------\r\n// apply element with id to this.id\r\n$.fn.widgets = function(func, data) {\r\n    return this.map(function(index, element) {\r\n        return $.data(element, \"widget\") || func(data || {}, element);\r\n    });\r\n};\r\n//----------------------------------------------------------------\r\n// apply element with id to this.id\r\n$.fn.widget = function(func, data) {\r\n    var $this = $(this);\r\n    return $this.data(\"widget\") || func && (func || Widget)(data || {}, $this);\r\n};\r\n\r\n"]],"start1":0,"start2":0,"length1":0,"length2":4453}]],"length":4453}
{"contributors":[],"silentsave":false,"ts":1359158905650,"patch":[[{"diffs":[[1,"    "],[0,"\"use str"]],"start1":0,"start2":0,"length1":8,"length2":12},{"diffs":[[0,"ct\";\r\n\r\n"],[1,"    var $ = "],[0,"require("]],"start1":13,"start2":13,"length1":16,"length2":28},{"diffs":[[0,"e(\"j"],[-1,"q"],[1,"Q"],[0,"uery\")"],[-1,";"],[0,"\r\n"],[-1,"\r\nvar $ = jQuery,\r\n\tutil = require(\"./util\");\r\n\r\n// Called on function.extend\r\nexports.Widget = util.extender({\r\n    // TODO: Widget.data function with redraw when data changed\r\n    // TODO: Proxy all function\r\n    // $(initElement)\r\n    initElement: \"<div>Widget</div>\"\r\n    // initialize\r\n    , initialize: function() { }\r\n    // signals description {\"click .btn\" : clicked}\r\n    //, TODO: signals: {} // if need\r\n    // events description {\"click .btn\" : clicked}\r\n    , events: {}\r\n    // default object\r\n    , defaults:{}\r\n    // render element \r\n    , render: function() {\r\n        return this;\r\n    }\r\n    // TODO: var listregexp = listregexp || [];\r\n    , dataChanged: function(e, data) {\r\n        //console.log(\"dataChanged\", data, this);\r\n        for (var key in data) {\r\n            data.hasOwnProperty(key) && this.triggerHandler(\"data:\" + key, [data[key]]); //FIXME:  this.data(key)\r\n        }\r\n        this.triggerHandler(\"data\", [data]);\r\n        //TODO: (_render === false) flag\r\n        \r\n        return false;\r\n    }\r\n    // return proxy function\r\n    , proxy: function(func) {\r\n        typeof(func) === \"string\" && ( func = this[func] );\r\n        return $.proxy(func, this);\r\n    }\r\n    // apply element with id to this.id\r\n    , applyNamesById: function() {\r\n        var self = this;\r\n        this.find('[id]').each(function(idx, element) {\r\n            var $el = $(element);\r\n            var id = $el.attr(\"id\");\r\n            self[id] = self[id] || $el;\r\n        })\r\n    }\r\n    // proxy to this all own functions\r\n    , applyProxy: function() {\r\n        for (var key in this) {\r\n            var func = this[key];\r\n            // proxy only own functions\r\n            if ( !( this.hasOwnProperty(key) && typeof(func) === \"function\" ) )\r\n                continue"],[1,"    , _ = require(\"_\")\r\n    , Widget = require(\"ax.widget\").Widget;\r\n    \r\n    _.templateSettings = $.extend({}, _.templateSettings, {\r\n//        interpolatec: /\\{\\{=(.+?)\\}\\}/g,\r\n//        evaluate    : /\\{\\{(.+?)\\}\\}/g,\r\n//        escape      : /\\{\\{-(.+?)\\}\\}/g,\r\n        variable: 'data'\r\n    })"],[0,";\r\n"],[-1,"\r\n"],[0,"    "],[-1,"        this[key] = $.proxy(func, this);\r\n        }\r\n    }\r\n    // process events map\r\n    , applyEvents: function() {\r\n        var events = this.events || {};\r\n        for (var key in events) {\r\n            if (!events.hasOwnProperty(key))\r\n                continue;\r\n            var func = events[key];\r\n            typeof(func) !== \"function\" && (func = this[func]);\r\n            typeof(func) !== \"function\" && console.log(\"error function: \", func);\r\n            var match = key.match( /^(\\S+)\\s*(.*)$/);\r\n            var event = match[1], selector = match[2];\r\n            selector ? this.on(event, selector, this.proxy(func)) : this.on(event, this.proxy(func))\r\n        }\r\n    }\r\n},"],[1,"exports._Widget = Widget.extend({\r\n        template: \"Template\"\r\n        , render:"],[0," fun"]],"start1":39,"start2":39,"length1":2495,"length2":405},{"diffs":[[0,"ion("],[-1,"data, el"],[0,") {\r"]],"start1":446,"start2":446,"length1":16,"length2":8},{"diffs":[[0,"    "],[-1,"\r\n"],[0,"    "],[-1,"// FIXME: fix when called as function\r\n    el = $(el || ((typeof(this.initElement) === \"function\") ? this.initElement() : this.initElement));\r\n\r\n    var ctor = function() {};\r\n    ctor.prototype = el;\r\n    var widget = new ctor();\r\n\r\n    el.data(\"widget\", widget);\r\n    $.extend(widget, this);\r\n\r\n    // extend data \r\n    data = $.extend({}, this.defaults, data || {});\r\n    widget.data(data);\r\n\r\n    // Some extra init\r\n    widget.applyNamesById();\r\n    // FIXME: widget.applyProxy();\r\n    widget.applyEvents();\r\n    widget.on(\"dataChanged\", widget.proxy(widget.dataChanged))\r\n    widget.on(\"data\", widget.proxy(widget.render));\r\n    \r\n    widget.initialize();\r\n    \r\n    widget.triggerHandler(\"dataChanged\", [widget.data()]);\r\n    return widget;\r\n});\r\n\r\n//----------------------------------------------------------------\r\n// FIXME: or fix jquery - $(elem)data(obj) trigger changeData event\r\n$.fn.data = (function() {\r\n    var $data = $.fn.data;\r\n    return function (key, value) {\r\n        var res = $data.apply(this, arguments);\r\n\r\n        // trigger only if set data\r\n        if ( !( !arguments.length || ( arguments.length === 1 && typeof(key) === \"string\" ) ) ) {\r\n            var data = {};\r\n            typeof(key) === \"string\" ? data[key] = value : data = key;\r\n            this.triggerHandler(\"dataChanged\", data);\r\n    "],[1,"    this.html(this.templ(this.data()));\r\n        }\r\n        , initialize: function() {\r\n            this.templ = _.template(this.template);\r\n//"],[0,"    "],[-1,"}\r\n"],[0,"        "],[-1,"return res;\r\n    };\r\n})();\r\n//----------------------------------------------------------------\r\n// apply element with id to this.id\r\n$.fn.widgets = function(func, data) {\r\n    return this.map(function(index, element) {\r\n        return $.data(element, \"widget\") || func(data || {}, element);\r\n    });\r\n};\r\n//----------------------------------------------------------------\r\n// apply element with id to this.id\r\n$.fn.widget = function(func, data) {\r\n    var $this = $(this);\r\n    return $this.data(\"widget\") || func && (func || Widget)(data || {}, $this);\r\n};\r\n"],[1,"console.log(this.templ.source);\r\n        }\r\n    });"],[0,"\r\n"]],"start1":455,"start2":455,"length1":1916,"length2":216}]],"length":671,"saved":false}
{"contributors":[],"silentsave":true,"ts":1359567734124,"patch":[[{"diffs":[[-1,"    "],[0,"\"use str"]],"start1":0,"start2":0,"length1":12,"length2":8},{"diffs":[[0,"ct\";"],[-1,"\r\n\r\n    var $ = "],[1,"\n\n"],[0,"requ"]],"start1":9,"start2":9,"length1":24,"length2":10},{"diffs":[[0,"ry\")"],[-1,"\r\n    , _ = require(\"_\")\r\n    ,"],[1,";\nrequire(\"_\");\n\nvar $ = jQuery\",\n   "],[0," Wid"]],"start1":28,"start2":28,"length1":39,"length2":45},{"diffs":[[0,"re(\""],[1,"."],[0,"ax"],[-1,"."],[1,"/"],[0,"widg"]],"start1":84,"start2":84,"length1":11,"length2":12},{"diffs":[[0,"get;"],[-1,"\r\n    \r\n    "],[1,"\n\n"],[0,"_.te"]],"start1":104,"start2":104,"length1":20,"length2":10},{"diffs":[[0,"tings, {"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"//      "]],"start1":157,"start2":157,"length1":18,"length2":21},{"diffs":[[0,"{\\{=(.+?)\\}\\}/g,"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"//        evalua"]],"start1":196,"start2":196,"length1":34,"length2":37},{"diffs":[[0,")\\}\\}/g,"],[-1,"\r"],[0,"\n"],[1,"    "],[0,"//      "]],"start1":250,"start2":250,"length1":18,"length2":21},{"diffs":[[0,")\\}\\}/g,"],[-1,"\r\n    "],[1,"\n"],[0,"    vari"]],"start1":297,"start2":297,"length1":22,"length2":17},{"diffs":[[0,"ata'"],[-1,"\r\n    });\r\n    "],[1,"\n});\n"],[0,"expo"]],"start1":322,"start2":322,"length1":23,"length2":13},{"diffs":[[0,"extend({"],[-1,"\r"],[0,"\n"],[-1,"    "],[0,"    temp"]],"start1":356,"start2":356,"length1":22,"length2":17},{"diffs":[[0,"emplate\""],[-1,"\r\n   "],[1,",\n"],[0,"   "],[-1,"  ,"],[0," render:"]],"start1":381,"start2":381,"length1":27,"length2":21},{"diffs":[[0,"er: function() {"],[-1,"\r\n    "],[1,"\n"],[0,"        this.htm"]],"start1":399,"start2":399,"length1":38,"length2":33},{"diffs":[[0,")));"],[-1,"\r"],[0,"\n    "],[1,"},\n"],[0,"   "],[-1," }\r\n        ,"],[0," ini"]],"start1":455,"start2":455,"length1":30,"length2":19},{"diffs":[[0,"tion() {"],[-1,"\r\n    "],[1,"\n"],[0,"        "]],"start1":487,"start2":487,"length1":22,"length2":17},{"diffs":[[0,"mplate);"],[-1,"\r"],[0,"\n"],[1,"        "],[0,"//      "]],"start1":535,"start2":535,"length1":18,"length2":25},{"diffs":[[0,"ce);"],[-1,"\r\n        }\r"],[0,"\n    "],[1,"}\n"],[0,"});"],[-1,"\r"],[0,"\n"]],"start1":593,"start2":593,"length1":26,"length2":15}]],"length":608,"saved":false}
{"ts":1359567736294,"patch":[[{"diffs":[[0,"e(\"."],[-1,"ax"],[0,"/wid"]],"start1":85,"start2":85,"length1":10,"length2":8}]],"length":606,"saved":false}
{"ts":1359567778454,"patch":[[{"diffs":[[0,"Template"],[1,"{}"],[0,"\",\n    r"]],"start1":378,"start2":378,"length1":16,"length2":18}]],"length":608,"saved":false}
{"ts":1359567781229,"patch":[[{"diffs":[[0,"emplate{"],[1,"{}"],[0,"}\",\n    "]],"start1":379,"start2":379,"length1":16,"length2":18}]],"length":610,"saved":false}
{"ts":1359567783789,"patch":[[{"diffs":[[0,"mplate{{"],[1,"  "],[0,"}}\",\n   "]],"start1":380,"start2":380,"length1":16,"length2":18}]],"length":612,"saved":false}
{"ts":1359567793706,"patch":[[{"diffs":[[0,"plate{{ "],[1,"<%"],[0," }}\",\n  "]],"start1":381,"start2":381,"length1":16,"length2":18}]],"length":614,"saved":false}
{"ts":1359567797132,"patch":[[{"diffs":[[0,"ate{{ <%"],[1,"%"],[0," }}\",\n  "]],"start1":383,"start2":383,"length1":16,"length2":17}]],"length":615,"saved":false}
{"ts":1359567798347,"patch":[[{"diffs":[[0,"te{{ <%%"],[1,">"],[0," }}\",\n  "]],"start1":384,"start2":384,"length1":16,"length2":17}]],"length":616,"saved":false}
{"ts":1359567801494,"patch":[[{"diffs":[[0,"ate{{ <%"],[1,"a"],[0,"%> }}\",\n"]],"start1":383,"start2":383,"length1":16,"length2":17}]],"length":617,"saved":false}
{"contributors":[],"silentsave":true,"ts":1359645884523,"patch":[[{"diffs":[[0,"= jQuery"],[-1,"\""],[0,",\n    Wi"]],"start1":55,"start2":55,"length1":17,"length2":16},{"diffs":[[0,"});\n"],[-1,"exports._Widget "],[1,"var Widget = module.exports"],[0,"= Wi"]],"start1":324,"start2":324,"length1":24,"length2":35}]],"length":627,"saved":false}
{"contributors":[],"silentsave":true,"ts":1360091077128,"patch":[[{"diffs":[[0,"quire(\"j"],[-1,"Q"],[1,"q"],[0,"uery\");\n"]],"start1":17,"start2":17,"length1":17,"length2":17}]],"length":627,"saved":false}
{"ts":1360091496948,"patch":[[{"diffs":[[0,"equire(\""],[-1,"_"],[1,"underscore"],[0,"\");\n\nvar"]],"start1":35,"start2":35,"length1":17,"length2":26}]],"length":636,"saved":false}
{"ts":1360091639521,"patch":[[{"diffs":[[0,"y\");"],[-1,"\nrequire(\"underscore\");"],[0,"\n\nva"]],"start1":29,"start2":29,"length1":31,"length2":8},{"diffs":[[0,"jQuery,\n"],[1,"\n"],[0,"    Widg"]],"start1":43,"start2":43,"length1":16,"length2":17}]],"length":614,"saved":false}
{"ts":1360091640375,"patch":[[{"diffs":[[0,"jQuery,\n"],[1,"    "],[0,"\n    Wid"]],"start1":43,"start2":43,"length1":16,"length2":20}]],"length":618,"saved":false}
{"ts":1360091641340,"patch":[[{"diffs":[[0,"ry,\n    "],[1,"require(\"underscore\")"],[0,"\n    Wid"]],"start1":47,"start2":47,"length1":16,"length2":37}]],"length":639,"saved":false}
{"ts":1360091644143,"patch":[[{"diffs":[[0,"ry,\n    "],[1,"_"],[0,"require("]],"start1":47,"start2":47,"length1":16,"length2":17}]],"length":640,"saved":false}
{"ts":1360091646297,"patch":[[{"diffs":[[0,"y,\n    _"],[1," "],[0,"require("]],"start1":48,"start2":48,"length1":16,"length2":17}]],"length":641,"saved":false}
{"ts":1360091646898,"patch":[[{"diffs":[[0,",\n    _ "],[1,"="],[0,"require("]],"start1":49,"start2":49,"length1":16,"length2":17}]],"length":642,"saved":false}
{"ts":1360091647594,"patch":[[{"diffs":[[0,"\n    _ ="],[1," "],[0,"require("]],"start1":50,"start2":50,"length1":16,"length2":17}]],"length":643,"saved":false}
{"ts":1360091654756,"patch":[[{"diffs":[[0,"rscore\")"],[1,","],[0,"\n    Wid"]],"start1":72,"start2":72,"length1":16,"length2":17}]],"length":644,"saved":false}
{"ts":1360091763196,"patch":[[{"diffs":[[0,"et\")"],[-1,".Widget"],[0,";\n\n_"]],"start1":110,"start2":110,"length1":15,"length2":8}]],"length":637,"saved":false}
